{
  "hash": "6cf5705a2b598665faabcefe82e79d42",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In-Class Exercise 01\"\nauthor: \"Bhairavi Vairavelu\"\ndate: \"Aug 26 2024\"\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  message: false\n  freeze: true\n---\n\n\n## 1. Getting Started\n\n### 1.1 Loading the R Packages\n\nThis code chunk loads the R packages we require for this exercise:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, sf, tmap, ggstatsplot)\n```\n:::\n\n\n### 1.2 Loading the Data\n\nThis code chunk imports the shapefile:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz14_shp <- st_read(dsn = \"data\", \n                     layer = \"MP14_SUBZONE_WEB_PL\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `MP14_SUBZONE_WEB_PL' from data source \n  `C:\\byebhai8\\ISSS626-GeospatialAnalytics\\In-Class_Ex\\In-Class_Ex01\\data' \n  using driver `ESRI Shapefile'\nSimple feature collection with 323 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21\n```\n\n\n:::\n:::\n\n\nThis code chunk (should) import the kml file. However, since it's corrupted we will not be using it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# mpsz14_kml <- st_read(\"data/MasterPlan2014SubzoneBoundaryWebKML.kml\")\n```\n:::\n\n\nWe could help GovTech by writing out a new kml file and send it back to them :)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#st_write(mpsz14_shp,\n#         \"data/MP14_SUBZONE_WEB_PL.kml\",\n#         delete_dsn = TRUE)\n```\n:::\n\n\nThis code chunk imports the Pre-Schools Location kml and geojson file and saves it in a sf simple data frame:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npreschool_kml <- st_read(\"data/PreSchoolsLocation.kml\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `PRESCHOOLS_LOCATION' from data source \n  `C:\\byebhai8\\ISSS626-GeospatialAnalytics\\In-Class_Ex\\In-Class_Ex01\\data\\PreSchoolsLocation.kml' \n  using driver `KML'\nSimple feature collection with 2290 features and 2 fields\nGeometry type: POINT\nDimension:     XYZ\nBounding box:  xmin: 103.6878 ymin: 1.247759 xmax: 103.9897 ymax: 1.462134\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\npreschool_geojson <- st_read(\"data/PreSchoolsLocation.geojson\") \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `PreSchoolsLocation' from data source \n  `C:\\byebhai8\\ISSS626-GeospatialAnalytics\\In-Class_Ex\\In-Class_Ex01\\data\\PreSchoolsLocation.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 2290 features and 2 fields\nGeometry type: POINT\nDimension:     XYZ\nBounding box:  xmin: 103.6878 ymin: 1.247759 xmax: 103.9897 ymax: 1.462134\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\nThis code chunk imports the Master Plan 2019 shapefile:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz19_shp <- st_read(dsn = \"data/\", \n                      layer = \"MPSZ-2019\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `MPSZ-2019' from data source \n  `C:\\byebhai8\\ISSS626-GeospatialAnalytics\\In-Class_Ex\\In-Class_Ex01\\data' \n  using driver `ESRI Shapefile'\nSimple feature collection with 332 features and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\nThis code chunk imports the Master Plan 2019 kml file, However, I'm encountering an error with this line of code..\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#mpsz19_kml <- st_read(\"data/MasterPlan2019SubzoneBoundaryNoSeaKML.kml\")\n```\n:::\n\n\n## 2. Handling Coordinate Systems\n\n### 2.1 Verifying Coordinate System\n\nThis code chunk is used to check the project of the imported sf objects:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(mpsz19_shp)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System:\n  User input: WGS 84 \n  wkt:\nGEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"latitude\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"longitude\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    ID[\"EPSG\",4326]]\n```\n\n\n:::\n:::\n\n\nFrom the above output, we know that it is using EPSG:4362 instead of EPSG:3414\n\n### 2.2 Transforming Coordinate System\n\nThis code chunk helps to transform the coordinate system of Master Plan 2019 shapefile:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz19_shp <- st_read(dsn = \"data/\", \n                     layer = \"MPSZ-2019\") %>%\n  st_transform(crs = 3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `MPSZ-2019' from data source \n  `C:\\byebhai8\\ISSS626-GeospatialAnalytics\\In-Class_Ex\\In-Class_Ex01\\data' \n  using driver `ESRI Shapefile'\nSimple feature collection with 332 features and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\nThis code chunk helps to transform the coordinate system of Pre-Schools Location kml file:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npreschool <- st_read(\"data/PreSchoolsLocation.kml\") %>%\n  st_transform(crs = 3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `PRESCHOOLS_LOCATION' from data source \n  `C:\\byebhai8\\ISSS626-GeospatialAnalytics\\In-Class_Ex\\In-Class_Ex01\\data\\PreSchoolsLocation.kml' \n  using driver `KML'\nSimple feature collection with 2290 features and 2 fields\nGeometry type: POINT\nDimension:     XYZ\nBounding box:  xmin: 103.6878 ymin: 1.247759 xmax: 103.9897 ymax: 1.462134\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n## 3. Geospatial Data Wrangling\n\n### 3.1 Point-in-Polygon Count\n\nThis code chunk is used to count the number of pre-schools in each planning sub-zone:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz19_shp <- mpsz19_shp %>%\n  mutate(`PreSch Count` = lengths(\n    st_intersects(mpsz19_shp, preschool)))\nmpsz19_shp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 332 features and 7 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21 / Singapore TM\nFirst 10 features:\n                 SUBZONE_N SUBZONE_C       PLN_AREA_N PLN_AREA_C       REGION_N\n1              MARINA EAST    MESZ01      MARINA EAST         ME CENTRAL REGION\n2         INSTITUTION HILL    RVSZ05     RIVER VALLEY         RV CENTRAL REGION\n3           ROBERTSON QUAY    SRSZ01  SINGAPORE RIVER         SR CENTRAL REGION\n4  JURONG ISLAND AND BUKOM    WISZ01  WESTERN ISLANDS         WI    WEST REGION\n5             FORT CANNING    MUSZ02           MUSEUM         MU CENTRAL REGION\n6         MARINA EAST (MP)    MPSZ05    MARINE PARADE         MP CENTRAL REGION\n7                   SUDONG    WISZ03  WESTERN ISLANDS         WI    WEST REGION\n8                  SEMAKAU    WISZ02  WESTERN ISLANDS         WI    WEST REGION\n9           SOUTHERN GROUP    SISZ02 SOUTHERN ISLANDS         SI CENTRAL REGION\n10                 SENTOSA    SISZ01 SOUTHERN ISLANDS         SI CENTRAL REGION\n   REGION_C                       geometry PreSch Count\n1        CR MULTIPOLYGON (((33222.98 29...            0\n2        CR MULTIPOLYGON (((28481.45 30...            1\n3        CR MULTIPOLYGON (((28087.34 30...            6\n4        WR MULTIPOLYGON (((14557.7 304...            0\n5        CR MULTIPOLYGON (((29542.53 31...            0\n6        CR MULTIPOLYGON (((35279.55 30...            0\n7        WR MULTIPOLYGON (((15772.59 21...            0\n8        WR MULTIPOLYGON (((19843.41 21...            0\n9        CR MULTIPOLYGON (((30870.53 22...            0\n10       CR MULTIPOLYGON (((26879.04 26...            4\n```\n\n\n:::\n:::\n\n\nThe new column (PreSch Count) has been added to the data frame as shown in the result output above.\n\n### 3.2 Computing Density\n\nThe following code chunk can be used to: - Derive the area of each planning sub-zone - Drop the unit of measurement of the area - Calculate the density of pre-schools at the planning sub-zone level\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz19_shp <- mpsz19_shp %>%\n  mutate(Area = units::drop_units(\n    st_area(.)),\n    `PreSch Density` = `PreSch Count` / Area * 1000000\n  )\nmpsz19_shp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 332 features and 9 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21 / Singapore TM\nFirst 10 features:\n                 SUBZONE_N SUBZONE_C       PLN_AREA_N PLN_AREA_C       REGION_N\n1              MARINA EAST    MESZ01      MARINA EAST         ME CENTRAL REGION\n2         INSTITUTION HILL    RVSZ05     RIVER VALLEY         RV CENTRAL REGION\n3           ROBERTSON QUAY    SRSZ01  SINGAPORE RIVER         SR CENTRAL REGION\n4  JURONG ISLAND AND BUKOM    WISZ01  WESTERN ISLANDS         WI    WEST REGION\n5             FORT CANNING    MUSZ02           MUSEUM         MU CENTRAL REGION\n6         MARINA EAST (MP)    MPSZ05    MARINE PARADE         MP CENTRAL REGION\n7                   SUDONG    WISZ03  WESTERN ISLANDS         WI    WEST REGION\n8                  SEMAKAU    WISZ02  WESTERN ISLANDS         WI    WEST REGION\n9           SOUTHERN GROUP    SISZ02 SOUTHERN ISLANDS         SI CENTRAL REGION\n10                 SENTOSA    SISZ01 SOUTHERN ISLANDS         SI CENTRAL REGION\n   REGION_C                       geometry PreSch Count       Area\n1        CR MULTIPOLYGON (((33222.98 29...            0  1844041.7\n2        CR MULTIPOLYGON (((28481.45 30...            1   392563.3\n3        CR MULTIPOLYGON (((28087.34 30...            6   506589.0\n4        WR MULTIPOLYGON (((14557.7 304...            0 36639387.1\n5        CR MULTIPOLYGON (((29542.53 31...            0   388733.2\n6        CR MULTIPOLYGON (((35279.55 30...            0  1590339.9\n7        WR MULTIPOLYGON (((15772.59 21...            0  4207271.1\n8        WR MULTIPOLYGON (((19843.41 21...            0  4963787.2\n9        CR MULTIPOLYGON (((30870.53 22...            0  2206353.6\n10       CR MULTIPOLYGON (((26879.04 26...            4  4919832.8\n   PreSch Density\n1       0.0000000\n2       2.5473596\n3      11.8439218\n4       0.0000000\n5       0.0000000\n6       0.0000000\n7       0.0000000\n8       0.0000000\n9       0.0000000\n10      0.8130358\n```\n\n\n:::\n:::\n\n\nThe new columns (Area, PreSch Density) have been added to the data frame as shown in the result output above.\n\n## 4. Statistical Analysis\n\nBy using Exploratory Data Analysis (EDA) and Confirmatory Data Analysis (CDA), we can explore and confirm the statistical relationship between Pre-School Density and Pre-School Count.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz19_shp$`PreSch Density` <- as.numeric(as.character(mpsz19_shp$`PreSch Density`))\nmpsz19_shp$`PreSch Count` <- as.numeric(as.character(mpsz19_shp$`PreSch Count`)) \nmpsz19_shp_new <- as.data.frame(mpsz19_shp)\n\nggscatterstats(data = mpsz19_shp_new,\n               x = `PreSch Density`,\n               y = `PreSch Count`,\n               type = \"parametric\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRegistered S3 method overwritten by 'ggside':\n  method from   \n  +.gg   ggplot2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](In-Class_Ex01A_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n## 5. Population Data\n\n### 5.1 Loading the Data\n\nThe code chunk below is used to load the Singapore Residents by Planning Area / Subzone, Age Group, Sex and Type of Dwelling data from Singtat:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata <- read_csv(\"data/respopagesextod2023.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 100928 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (5): PA, SZ, AG, Sex, TOD\ndbl (2): Pop, Time\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n### 5.2 Data Wrangling\n\nThe code chunk below is used to prepare a data frame showing the population by Planning Area and Planning Subzone:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata2023 <- popdata %>% \n  group_by(PA, SZ, AG) %>% \n  summarise(`POP`=sum(`Pop`)) %>%  \n  ungroup() %>% \n  pivot_wider(names_from=AG,\n              values_from = POP)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'PA', 'SZ'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code}\ncolnames(popdata2023)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"PA\"          \"SZ\"          \"0_to_4\"      \"10_to_14\"    \"15_to_19\"   \n [6] \"20_to_24\"    \"25_to_29\"    \"30_to_34\"    \"35_to_39\"    \"40_to_44\"   \n[11] \"45_to_49\"    \"50_to_54\"    \"55_to_59\"    \"5_to_9\"      \"60_to_64\"   \n[16] \"65_to_69\"    \"70_to_74\"    \"75_to_79\"    \"80_to_84\"    \"85_to_89\"   \n[21] \"90_and_Over\"\n```\n\n\n:::\n:::\n\n\n### 5.3 Data Processing\n\nThe code chunk below achieves the following logic: - YOUNG: age group 0 to 4 until age group 20 to 24 - ECONOMY ACTIVE: age group 25-29 until age group 60-64 - AGED: age group 65 and above - TOTAL: all age groups - DEPENDENCY; the ratio between young and aged against the economy active group\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata2023 <- popdata2023 %>%\n  mutate(YOUNG=rowSums(.[3:6]) # Aged 0 - 24, 10 - 24\n         +rowSums(.[14])) %>% # Aged 5 - 9\n  mutate(`ECONOMY ACTIVE` = rowSums(.[7:13])+ # Aged 25 - 59\n  rowSums(.[15])) %>%  # Aged 60 -64\n  mutate(`AGED`=rowSums(.[16:21])) %>%\n  mutate(`TOTAL`=rowSums(.[3:21])) %>%\n  mutate(`DEPENDENCY`=(`YOUNG` + `AGED`)\n  / `ECONOMY ACTIVE`) %>% \n  select(`PA`, `SZ`, `YOUNG`, \n         `ECONOMY ACTIVE`, `AGED`,\n         `TOTAL`, `DEPENDENCY`)\n```\n:::\n\n\nLet's take a look at the transformed data frame:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata2023\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 332 × 7\n   PA         SZ                     YOUNG `ECONOMY ACTIVE`  AGED TOTAL DEPEND…¹\n   <chr>      <chr>                  <dbl>            <dbl> <dbl> <dbl>    <dbl>\n 1 Ang Mo Kio Ang Mo Kio Town Centre  1240             2830   890  4960    0.753\n 2 Ang Mo Kio Cheng San               5150            15600  6580 27330    0.752\n 3 Ang Mo Kio Chong Boon              4620            14120  7060 25800    0.827\n 4 Ang Mo Kio Kebun Bahru             4320            12400  5640 22360    0.803\n 5 Ang Mo Kio Sembawang Hills         1840             3670  1420  6930    0.888\n 6 Ang Mo Kio Shangri-La              3810             9600  4320 17730    0.847\n 7 Ang Mo Kio Tagore                  1870             4320  1790  7980    0.847\n 8 Ang Mo Kio Townsville              3750            11090  5390 20230    0.824\n 9 Ang Mo Kio Yio Chu Kang               0                0     0     0  NaN    \n10 Ang Mo Kio Yio Chu Kang East       1090             2410   880  4380    0.817\n# … with 322 more rows, and abbreviated variable name ¹​DEPENDENCY\n```\n\n\n:::\n:::\n\n\n### 5.4 Joining Data\n\nThe code chunk below is used to join the popdata2023 with the mpsz19_shp data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata2023 <- popdata2023 %>%\n  mutate_at(.vars = vars(PA, SZ), \n          .funs = list(toupper)) \n\nmpsz_pop2023 <- left_join(mpsz19_shp, popdata2023,\n                          by = c(\"SUBZONE_N\" = \"SZ\"))\n\npop2023_mpsz <- left_join(popdata2023, mpsz19_shp, \n                          by = c(\"SZ\" = \"SUBZONE_N\"))\n```\n:::\n\n\n## 6. Analytical Maps\n\n### 6.1 Percentile Map\n\nThe percentile map is a special type of quantile map with six specific categories: 0-1%,1-10%, 10-50%,50-90%,90-99%, and 99-100%. The corresponding breakpoints can be derived by means of the base R quantile command, passing an explicit vector of cumulative probabilities as c(0,.01,.1,.5,.9,.99,1). Note that the begin and endpoint need to be included.\n\nStep 1: Data Preparation The code chunk below helps to exclude records with NA:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz_pop2023 <- mpsz_pop2023 %>%\n  drop_na()\n```\n:::\n\n\nStep 2: get function The code chunk below defines a function to get the input data and field that is to be used to create the percentile map:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget.var <- function(vname, df) {\n  v <- df[vname] %>% st_set_geometry(NULL)\n  v <- unname(v[,1]) # unlist(v)\n  return(v)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz19_shp\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 332 features and 9 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21 / Singapore TM\nFirst 10 features:\n                 SUBZONE_N SUBZONE_C       PLN_AREA_N PLN_AREA_C       REGION_N\n1              MARINA EAST    MESZ01      MARINA EAST         ME CENTRAL REGION\n2         INSTITUTION HILL    RVSZ05     RIVER VALLEY         RV CENTRAL REGION\n3           ROBERTSON QUAY    SRSZ01  SINGAPORE RIVER         SR CENTRAL REGION\n4  JURONG ISLAND AND BUKOM    WISZ01  WESTERN ISLANDS         WI    WEST REGION\n5             FORT CANNING    MUSZ02           MUSEUM         MU CENTRAL REGION\n6         MARINA EAST (MP)    MPSZ05    MARINE PARADE         MP CENTRAL REGION\n7                   SUDONG    WISZ03  WESTERN ISLANDS         WI    WEST REGION\n8                  SEMAKAU    WISZ02  WESTERN ISLANDS         WI    WEST REGION\n9           SOUTHERN GROUP    SISZ02 SOUTHERN ISLANDS         SI CENTRAL REGION\n10                 SENTOSA    SISZ01 SOUTHERN ISLANDS         SI CENTRAL REGION\n   REGION_C                       geometry PreSch Count       Area\n1        CR MULTIPOLYGON (((33222.98 29...            0  1844041.7\n2        CR MULTIPOLYGON (((28481.45 30...            1   392563.3\n3        CR MULTIPOLYGON (((28087.34 30...            6   506589.0\n4        WR MULTIPOLYGON (((14557.7 304...            0 36639387.1\n5        CR MULTIPOLYGON (((29542.53 31...            0   388733.2\n6        CR MULTIPOLYGON (((35279.55 30...            0  1590339.9\n7        WR MULTIPOLYGON (((15772.59 21...            0  4207271.1\n8        WR MULTIPOLYGON (((19843.41 21...            0  4963787.2\n9        CR MULTIPOLYGON (((30870.53 22...            0  2206353.6\n10       CR MULTIPOLYGON (((26879.04 26...            4  4919832.8\n   PreSch Density\n1       0.0000000\n2       2.5473596\n3      11.8439218\n4       0.0000000\n5       0.0000000\n6       0.0000000\n7       0.0000000\n8       0.0000000\n9       0.0000000\n10      0.8130358\n```\n\n\n:::\n:::\n\n\nStep 3: Percentile Mapping function The code chunk below creates a function for computing and plotting the percentile map:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npercentmap <- function(vnam, df, legtitle=NA, mtitle=\"Percentile Map\"){\n  percent <- c(0,.01,.1,.5,.9,.99,1)\n  var <- get.var(vnam, df)\n  bperc <- quantile(var, percent)\n  tm_shape(mpsz_pop2023) +\n  tm_polygons() +\n  tm_shape(df) +\n     tm_fill(vnam,\n             title=legtitle,\n             breaks=bperc,\n             palette=\"Blues\",\n          labels=c(\"< 1%\", \"1% - 10%\", \"10% - 50%\", \"50% - 90%\", \"90% - 99%\", \"> 99%\"))  +\n  tm_borders() +\n  tm_layout(main.title = mtitle, \n            title.position = c(\"right\",\"bottom\"))\n}\n```\n:::\n\n\nStep 4: Running the functions The code chunk below runs the percentile map function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npercentmap(\"DEPENDENCY\", mpsz_pop2023)\n```\n\n::: {.cell-output-display}\n![](In-Class_Ex01A_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "In-Class_Ex01A_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}